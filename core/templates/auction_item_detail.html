{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>window.FontAwesomeConfig = { autoReplaceSvg: 'nest' };</script>
  <script crossorigin="anonymous" referrerpolicy="no-referrer"
          src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;500;600;700;800;900&display=swap"
    rel="stylesheet"/>
  <link href="{% static 'galactic-theme.css' %}" rel="stylesheet"/>
</head>
<body class="bg-black text-gray-200">
  <!-- Header/Nav -->
  <header class="fixed w-full bg-black/90 backdrop-blur-lg border-b border-gray-800 z-50" id="header">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-20">
        <div class="flex items-center">
          <i class="fa-brands fa-jedi-order text-4xl text-yellow-500 mr-3"></i>
          <span class="text-2xl font-bold">The Galactic Hub</span>
        </div>
        <nav class="hidden md:flex space-x-8">
          <a class="hover:text-yellow-500" href="{% url 'index' %}">Home</a>
          <a class="hover:text-yellow-500" href="{% url 'products' %}">Shop</a>
          <a class="hover:text-yellow-500" href="{% url 'inventory_dashboard' %}">Inventory</a>
          <a class="hover:text-yellow-500" href="{% url 'auction' %}">Auctions</a>
          <a class="hover:text-yellow-500" href="{% url 'wishlist' %}">Wishlist</a>
        </nav>
        <div class="flex items-center space-x-4">
          <button class="p-2 hover:text-yellow-500"><i class="fa-solid fa-search"></i></button>
          <button class="p-2 hover:text-yellow-500"><i class="fa-solid fa-user"></i></button>
          <button class="p-2 hover:text-yellow-500"><i class="fa-solid fa-shopping-cart mr-2"></i></button>
        </div>
      </div>
    </div>
  </header>

  <main class="pt-16" id="main-content">
    <!-- Breadcrumb -->
    <div class="bg-gray-900/50 px-6 py-3 border-b border-gray-800" id="breadcrumb">
      <div class="container mx-auto flex items-center space-x-2 text-sm">
        <span class="text-yellow-500 hover:underline cursor-pointer">Auction Marketplace</span>
        <i class="fa-solid fa-chevron-right text-gray-500"></i>
        <span class="text-gray-300">{{ item.product_name }}</span>
      </div>
    </div>

    <div class="container mx-auto px-6 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left: Details -->
        <div class="lg:col-span-2" id="item-details">
          <!-- Featured Image & Thumbnails -->
          <div id="featured-item" class="hologram-glow rounded-xl p-6 bg-gray-900/50 mb-6">
            <!-- Main image always shown -->
            <img
              src="{{ item.image_url.url }}"
              alt="{{ item.product_name }}"
              class="w-full h-96 object-cover rounded-lg mb-4"
            />
            <!-- Only show thumbnails if there are additional_images -->
            {% if item.additional_images %}
              <div class="grid grid-cols-4 gap-2">
                {% for img_url in item.additional_images %}
                  <img
                    src="{{ img_url }}"
                    alt="{{ item.product_name }} extra {{ forloop.counter }}"
                    class="w-full h-20 object-cover rounded border border-gray-600"
                  />
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <!-- Title & Actions -->
          <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between mb-6">
            <div>
              <h1 class="text-3xl font-bold text-white mb-2">{{ item.product_name }}</h1>
              <div class="flex items-center space-x-4 text-sm text-gray-400 mb-4">
                <span class="flex items-center">
                  <i class="fa-solid fa-certificate text-yellow-500 mr-1"></i>
                  {{ item.authentication }}
                </span>
              </div>
            </div>
            <button class="flex items-center space-x-2 bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg">
              <i class="fa-solid fa-bell text-yellow-500"></i>
              <span class="text-sm">Get Alerts</span>
            </button>
          </div>

          <!-- Auction Info -->
          <div id="auction-info" class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-gray-800 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-green-400 aurebesh">
                {% if bids %}
                  ${{ bids.0.bid_amount }}
                {% else %}
                  ${{ item.starting_bid }}
                {% endif %}
              </div>
              <div class="text-sm text-gray-400">Current Bid</div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-blue-400">{{ bids|length }}</div>
              <div class="text-sm text-gray-400">Total Bids</div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg text-center lg:col-span-2">
              <div class="text-sm text-gray-400 mb-2">Time Remaining</div>
              <div class="flex items-center justify-center space-x-2">
                <div class="countdown-digit px-3 py-2 rounded aurebesh text-yellow-500">
                  {{ item.duration }}
                </div>
                <span class="text-gray-400">:</span>
                <div class="countdown-digit px-3 py-2 rounded aurebesh text-yellow-500">00</div>
                <span class="text-gray-400">:</span>
                <div class="countdown-digit px-3 py-2 rounded aurebesh text-yellow-500">00</div>
                <span class="text-gray-400">:</span>
                <div class="countdown-digit px-3 py-2 rounded aurebesh text-yellow-500">00</div>
              </div>
              <div class="text-xs text-gray-500 mt-1">D : H : M : S</div>
            </div>
          </div>

          <!-- Expandable Sections -->
          <div class="space-y-4" id="expandable-sections">
            <!-- Item Description -->
            <div class="bg-gray-800 rounded-lg">
              <button
                class="w-full flex items-center justify-between p-4 text-left"
                onclick="toggleSection('description')"
              >
                <span class="font-semibold">Item Description</span>
                <i class="fa-solid fa-chevron-down" id="desc-icon"></i>
              </button>
              <div class="px-4 pb-4 hidden" id="description">
                <p class="text-gray-300 mb-3">{{ item.description }}</p>
              </div>
            </div>

            <!-- Provenance & Verification (static) -->
            <div class="bg-gray-800 rounded-lg">
              <button
                class="w-full flex items-center justify-between p-4 text-left"
                onclick="toggleSection('provenance')"
              >
                <span class="font-semibold">Provenance &amp; Verification</span>
                <i class="fa-solid fa-chevron-down" id="prov-icon"></i>
              </button>
              <div class="px-4 pb-4 hidden" id="provenance">
                <div class="flex items-center space-x-2 mb-3">
                  <i class="fa-solid fa-shield-check text-green-400"></i>
                  <span class="text-green-400">Blockchain Verified</span>
                </div>
                <p class="text-gray-400 text-sm">Previous Owner: @JediCollector99</p>
              </div>
            </div>

            <!-- Seller Information (static) -->
            <div class="bg-gray-800 rounded-lg">
              <button
                class="w-full flex items-center justify-between p-4 text-left"
                onclick="toggleSection('seller')"
              >
                <span class="font-semibold">Seller Information</span>
                <i class="fa-solid fa-chevron-down" id="sell-icon"></i>
              </button>
              <div class="px-4 pb-4 hidden" id="seller">
                <div class="flex items-center space-x-3">
                  <img
                    class="w-10 h-10 rounded-full"
                    src="{% static 'images/profileimage.jpg' %}"
                  />
                  <div>
                    <div class="font-medium">@SithLordCollector</div>
                    <div class="text-sm text-green-400">★★★★★ (98% positive)</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Bid History -->
            <div class="bg-gray-800 rounded-lg">
              <button
                class="w-full flex items-center justify-between p-4 text-left"
                onclick="toggleSection('history')"
              >
                <span class="font-semibold">Bid History</span>
                <i class="fa-solid fa-chevron-down" id="hist-icon"></i>
              </button>
              <div class="px-4 pb-4 hidden" id="history">
                <!-- Dynamic Bid History -->
                <form method="post" class="flex items-center gap-4 mb-4">
                  {% csrf_token %}
                  <input
                    id="id_bid_amount"
                    name="bid_amount"
                    type="number"
                    step="0.01"
                    placeholder="Your bid"
                    required
                    class="px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white flex-1"
                  />
                  <button
                    type="submit"
                    class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-6 rounded-lg"
                  >
                    Place Bid
                  </button>
                </form>
                <hr class="border-gray-700 mb-4"/>
                <ul class="space-y-2 text-gray-200">
                  {% for bid in bids %}
                    <li class="flex justify-between items-center">
                      <span>{{ bid.bidder_name }}</span>
                      <span>${{ bid.bid_amount }}</span>
                      <span class="text-sm text-gray-500">{{ bid.timestamp|date:"M d, Y H:i" }}</span>
                    </li>
                  {% empty %}
                    <li class="text-gray-400">No bids yet.</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Bid Panel -->
        <div class="lg:sticky lg:top-24" id="bid-panel">
          <div class="bg-gray-900 border border-gray-700 rounded-xl p-6">
            <h3 class="text-xl font-bold mb-4 aurebesh text-yellow-500">PLACE YOUR BID</h3>
            <!-- Bid Form (same as above, hidden on large since inside history) -->
            <form method="post" class="mb-6">
              {% csrf_token %}
              <div class="mb-4">
                <label
                  for="id_bid_amount"
                  class="block text-sm font-medium text-gray-300 mb-2"
                >Bid Amount</label>
                <div class="relative">
                  <input
                    id="id_bid_amount"
                    name="bid_amount"
                    type="number"
                    step="0.01"
                    placeholder="0.00"
                    required
                    class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white pr-20 text-lg"
                  />
                  <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1">
                    <i class="fa-solid fa-coins text-yellow-500"></i>
                    <span class="text-sm text-gray-400">$</span>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mt-1">Minimum increment: 100 Credits</p>
              </div>
              <button
                type="submit"
                class="w-full bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-lg font-bold text-lg lightsaber-glow"
              >
                <i class="fa-solid fa-gavel mr-2"></i>PLACE BID
              </button>
            </form>
            <div class="text-center">
              <div class="flex items-center justify-center space-x-2 text-sm text-green-400 mb-2">
                <i class="fa-brands fa-ethereum"></i>
                <span>MetaMask Connected</span>
              </div>
              <p class="text-xs text-gray-500">Secure blockchain transactions</p>
            </div>
          </div>

          <!-- Auction Terms (static) -->
          <div class="mt-6 bg-gray-900 border border-gray-700 rounded-xl p-4">
            <h4 class="font-semibold mb-3">Auction Terms</h4>
            <div class="text-sm text-gray-400 space-y-2">
              <p>• 48-hour return policy</p>
              <p>• Free shipping worldwide</p>
              <p>• Authenticity guaranteed</p>
              <p>• NFT certificate included</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer (unchanged) -->
  <footer class="bg-gray-900 pt-20 pb-10" id="footer">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
        <!-- … your existing footer content … -->
      </div>
      <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
        <p>© 2025 The Galactic Hub. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    function toggleSection(id) {
      const sec = document.getElementById(id);
      const icon = document.getElementById(id.substring(0,4) + '-icon');
      sec.classList.toggle('hidden');
      icon.classList.toggle('fa-chevron-down');
      icon.classList.toggle('fa-chevron-up');
    }
  </script>
</body>
</html>
